<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SNAAAKE, SNAAAKE?</title>
    <style>
        td {
            width: 10px;
            height: 10px;
        }

        td.snake {
            background-color: chartreuse;
        }

        td.food {
            background-color: crimson;
        }
    </style>




</head>



<body onkeydown=" return snakeControls(event)">

    <table border="1" id="snakeTable"></table>


    <script>

        var snakeModel;
        initModel();
        display();

        setInterval(move, 300);

        function display() {
            let snakeTable = document.getElementById("snakeTable");
            snakeTable.innerHTML = '';


            for (let rowIndex = 0; rowIndex < snakeModel.size; rowIndex++) {
                let tr = snakeTable.insertRow();
                for (let columnindex = 0; columnindex < snakeModel.size; columnindex++) {
                    let td = tr.insertCell();

                }
            }
            let bodyPart = snakeModel.snakeHead;
            while(bodyPart != null) {
               let td = snakeTable.rows[bodyPart.y].cells[bodyPart.x];
                td.classList.add('snake');
                bodyPart = bodyPart.newBodyPart;
            }
           

            let food = snakeModel.food;
            let td = snakeTable.rows[food.y].cells[food.x];
            td.classList.add('food');
        }
        function initModel() {

            snakeModel = { size: 30 };
            snakeModel.snakeHead = createRandomPos();
            snakeModel.food = createRandomPos();
            snakeModel.growth = 0;
            snakeModel.newBodyPart = null;
        }


        function createRandomPos() {

            return {
                x: Math.floor(Math.random() * snakeModel.size),
                y: Math.floor(Math.random() * snakeModel.size)
            }

        }

        function move() {
            if (!snakeModel.direction) return;
            if (snakeModel.growth < 0) {
               
                let newSnakeHead = {
                    x: snakeModel.snakeHead.x + snakeModel.direction.x,
                    y: snakeModel.snakeHead.y + snakeModel.direction.y,
                    newBodyPart : snakeModel.snakeHead
                };
               snakeModel.snakeHead = newSnakeHead; 

            }
            else {
                snakeModel.snakeHead.x += snakeModel.direction.x
                snakeModel.snakeHead.y += snakeModel.direction.y
            }

            if (snakeModel.snakeHead.x === snakeModel.food.x
                && snakeModel.snakeHead.y === snakeModel.food.y) {
                snakeModel.food = createRandomPos();
                snakeModel.growth  = 1;

            }

            display();
        }

        function snakeControls(event) {
            if (event.keyCode == 37) {
                snakeModel.direction = { x: -1, y: 0 }; //L
            } else if (event.keyCode == 39) {
                snakeModel.direction = { x: 1, y: 0 }; // R
            } else if (event.keyCode == 38) {
                snakeModel.direction = { x: -0, y: -1 } //U
            } else if (event.keyCode == 40) {
                snakeModel.direction = { x: 0, y: 1 } //D
            }

        }

    </script>
</body>

</html>