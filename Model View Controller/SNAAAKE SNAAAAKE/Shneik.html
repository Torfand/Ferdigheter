<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SNAAAKE, SNAAAKE?</title>
    <style>
        td {
            width: 10px;
            height: 10px;
        }

        td.snake {
            background-color: chartreuse;
        }

        td.food {
            background-color: crimson;
        }
    </style>
</head>

<body onkeydown=" return snakeControls(event)">
    <div id="output">

    </div>
    <table border="1" id="snakeTable"></table>

    <script>
        //model

        var score = 0;
        var snakeModel;
        initModel();
        display();
        //view
        setInterval(move, 300);
        function display() {
            let output = document.getElementById("output")
            let page = '';
            let snakeTable = document.getElementById("snakeTable");
            snakeTable.innerHTML = '';
            page += `<h1> Score:${score}</h1>
            
            `


            for (let rowIndex = 0; rowIndex < snakeModel.size; rowIndex++) {
                let tr = snakeTable.insertRow();
                for (let columnindex = 0; columnindex < snakeModel.size; columnindex++) {
                    let td = tr.insertCell();
                }
            }
            let bodyPart = snakeModel.snakeHead;
            while (bodyPart != null) {
                let td = snakeTable.rows[bodyPart.y].cells[bodyPart.x];
                td.classList.add('snake');
                bodyPart = bodyPart.newBodyPart;
            }

            let food = snakeModel.food;
            let td = snakeTable.rows[food.y].cells[food.x];
            td.classList.add('food');

            output.innerHTML = page;

        }

        function playerScored() {

            if (snakeModel.growth > 0) {
                score++
            }
        }


        function initModel() {
            snakeModel = { size: 30 };
            snakeModel.snakeHead = createRandomPos();
            snakeModel.food = createRandomPos();
            snakeModel.growth = 0;
            snakeModel.newBodyPart = null;

        }

        function createRandomPos() {

            return {
                x: Math.floor(Math.random() * snakeModel.size),
                y: Math.floor(Math.random() * snakeModel.size)
            }
        }

        function crateNewSnakeHead() {
            return {
                x: snakeModel.snakeHead.x + snakeModel.direction.x,
                y: snakeModel.snakeHead.y + snakeModel.direction.y,
                newBodyPart: snakeModel.snakeHead


            };
        }
        //controller
        function move() {
            if (!snakeModel.direction) return;
            snakeModel.snakeHead = crateNewSnakeHead();
            if (snakeModel.growth > 0) {
                snakeModel.growth--;


            } else {
                let bodyPart = snakeModel.snakeHead;
                let lastBodyPart = null;
                while (bodyPart.newBodyPart != null) {
                    lastBodyPart = bodyPart;
                    bodyPart = bodyPart.newBodyPart;
                }
                if (lastBodyPart !== null) {
                    lastBodyPart.newBodyPart = null
                }
            }
            if (snakeModel.snakeHead.x === snakeModel.food.x
                && snakeModel.snakeHead.y === snakeModel.food.y) {
                snakeModel.food = createRandomPos();
                snakeModel.growth = 1;
                playerScored();
            }
            display();


        }

        function snakeControls(event) {
            if (event.keyCode == 37) {
                snakeModel.direction = { x: -1, y: 0 }; //Left
            } else if (event.keyCode == 39) {
                snakeModel.direction = { x: 1, y: 0 }; // Right
            } else if (event.keyCode == 38) {
                snakeModel.direction = { x: -0, y: -1 };//Up
            } else if (event.keyCode == 40) {
                snakeModel.direction = { x: 0, y: 1 } //Down
            }

        }

    </script>
</body>

</html>